package SeleniumBasics;
import java.io.File;
import java.io.IOException;

import org.apache.commons.io.FileUtils;
import org.apache.commons.lang3.time.StopWatch;
import org.apache.logging.log4j.Logger;
import org.openqa.selenium.By;
import org.openqa.selenium.OutputType;
import org.openqa.selenium.TakesScreenshot;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;

public class SL_TestCases {
	public void login(WebDriver driver, String username, String pwd, String test, Logger logger) throws InterruptedException, IOException{
		int Test = Integer.parseInt(test);
		StopWatch pageLoad = new StopWatch();
        pageLoad.start();
		driver.findElement(By.id("user-name")).sendKeys(username);
		driver.findElement(By.id("password")).sendKeys(pwd);
		driver.findElement(By.id("login-button")).click();
		String acturl = driver.getCurrentUrl();
		pageLoad.stop();
		long pageLoadTime = pageLoad.getTime();
		String expurl = "https://www.saucedemo.com/inventory.html";
		if(expurl.equals(acturl)) {
			logger.info("Successful test case #"+Test);
			logger.info("LOGIN Completed");
			String img = driver.findElement(By.xpath("//img[@alt='Sauce Labs Backpack']")).getAttribute("src");
			if(img.equals("https://www.saucedemo.com/static/media/sl-404.168b1cce.jpg")) {
				logger.error("***Product image problem found in test #"+Test+". Problem review needed.***");
				File screenshotFile = ((TakesScreenshot) driver).getScreenshotAs(OutputType.FILE);
				FileUtils.copyFile(screenshotFile, new File("Bug reported in test #"+Test+".png"));
			}
			if(pageLoadTime>300) {
				logger.error("***Performance failure in test #"+Test+". Problem review needed.***");
			}
		}
		else {
			WebElement errorObj = driver.findElement(By.xpath("//h3[@data-test='error']"));
			String error = errorObj.getText();
			File elementSs = errorObj.getScreenshotAs(OutputType.FILE);
			FileUtils.copyFile(elementSs, new File("Error message - TestCase #"+Test+".png"));
			if(error.equals("Epic sadface: Sorry, this user has been locked out.")) {
				logger.info("Successful test case #"+Test);
				logger.info("LOGIN Failed - User Locked Out");
			}
			else if(error.equals("Epic sadface: Username and password do not match any user in this service")) {
				logger.info("Successful test case #"+Test);
				logger.info("LOGIN Failed - Wrong Credentials");
			}
		}
	}
}
